generator client {
  provider = "prisma-client-js"
  output   = "../src/db/postgres/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum RolesType {
  BASIC   @map("basic")
  SPECIAL @map("special")
  PREMIUM @map("premium")
}

model User {
  id            BigInt          @id
  email         String          @unique
  verified      DateTime?
  username      String?
  roles         RolesType       @default(BASIC)
  avatar_url    String?
  created_at    DateTime        @default(now())

  password         UserPassword?
  oauths           UserOAuth[]
  sessions         Session[]
  projects         Project[]
  chats      Chat[]
}

model UserPassword {
  user_id      BigInt   @id
  password     String
  last_changed DateTime @default(now())

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model UserOAuth {
  id               BigInt   @id
  user_id          BigInt
  provider         String
  provider_user_id String
  refresh_token    String?  @db.Text
  access_token     String?  @db.Text
  expires_at       BigInt?
  token_type       String?
  scope            String?
  id_token         String?  @db.Text
  session_state    String?
  created_at       DateTime @default(now())

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_user_id])
}

model Session {
  id            BigInt   @id
  session_token String   @unique
  user_id       BigInt
  expires       DateTime
  user_agent    String?
  ip_address    String?
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Project {
  id            BigInt   @id
  user_id       BigInt
  position      Int
  name          String
  description   String?
  icon          String?  @default("chat")
  color         String?  @default("gray")
  created_at    DateTime @default(now())

  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Chat {
  id          BigInt   @id
  project_id  BigInt
  name        String
  category_id BigInt?
  owner_id    BigInt
  pinned      Boolean  @default(false)
  created_at  DateTime @default(now())

  owner       User     @relation(fields: [owner_id], references: [id], onDelete: Cascade)
}

model AIProfile {
  id         BigInt  @id
  name       String
  avatar_url String?

  models Model[]
}

model Model {
  id                  BigInt   @id
  ai_profile_id       BigInt
  provider            String
  api_identifier      String
  default_temperature Float
  created_at          DateTime @default(now())

  ai_profile AIProfile @relation(fields: [ai_profile_id], references: [id], onDelete: Cascade)
}